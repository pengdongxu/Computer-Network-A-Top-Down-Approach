## 第1章 计算机网络和英特网

### 分组交换  时延、丢包和吞吐量

分组从一台**主机**（源）出发，经过一些列**路由器**传输，在另一台主机（目的地）中结束它的历程。当从一个节点（主机或路由器）沿着这条路径到后继节点（主机或路由器），该分组在途径的每个节点经受了几种不同类型的时延。

##### 1、节点处理时延：

​	分组到达路由器时，**检查分组首部**和决定将该**分组导向何处**所需要的时间是处理时延的一部分

##### 2、排队时延

​	在队列中，当分组在链路上等待传输时，它经常受排队时延。

​	一个特定分组的排队时延长度将取决于先期到达的正在排队等待向链路传输的分组数量。

**3、传播时延**

​	表示将整个数据包从发送端传输到发送链路的过程中所需要的时间，取决于数据包大小和链路的带宽。

​	**公式**：			
$$
{传输时延} = \frac{\text{数据包大小}}{\text{带宽}}
$$


##### 4、传输时延

​	传播时延是指信号在物理介质（例如电缆或光缆）中传播所需要的时间，取决于介质的传播速度和链路公式。

**公式：**
$$
{传播时延} = \frac{\text{链路长度}}{\text{传播速度}}
$$

>传播时延和传输时延的区别？
>
>**传输时延**与数据包的大小和链路带宽相关，主要关注数据进入链路的时间。
>
>**传播时延**与链路的物理长度和信号传播速度有关，主要关注信号从发送端传播到接收端的时间。





### 流量强度

流量强度（Traffic Intensity）是网络中衡量数据流量的一个重要指标，通常用来表示单位时间内某个网络链路或系统的负载。流量强度通常用于描述网络中某段时间内的数据流入或流出量，以及该流量对网络资源的占用情况。

#### 流量强度的计算

流量强度的基本公式为：
$$
\rho = \frac{\lambda \times T}{C}
$$




其中：

- ``ρ`` 表示流量强度（Traffic Intensity）。
- ``λ`` 表示到达率（Arrival Rate），即单位时间内到达的数据量（通常以数据包数或数据比特数表示）。
- ``T ``表示数据包的持续时间或大小，通常用秒或比特来表示。
- ``C`` 表示链路的传输速率（Channel Capacity），通常用比特每秒（bps）来表示。

#### 解释：

- **到达率（λ）**：指在单位时间内请求或数据包到达的频率，通常以包/秒或比特/秒来表示。
- **数据包的持续时间（T）**：是指一个数据包的长度或传输所需的时间，通常与数据包的大小和链路带宽相关。
- **链路容量（C）**：指网络链路的传输能力，通常以比特每秒（bps）表示，例如 1 Gbps 或 10 Mbps。

#### 流量强度的意义：

- 当 ρ=1 时，表示网络链路已完全被占用，无法再承载更多流量。
- 当 ρ>1 时，表示链路的负载超过了其容量，可能导致网络拥塞。
- 当 ρ<1 时，表示网络链路有空闲容量，网络可以承载更多的流量。

#### 举例：

假设在某网络中：

- 每秒到达的请求为 1000 个数据包$（λ=1000 包/秒\lambda = 1000 \, \text{包/秒}λ=1000包/秒）。$
- 每个数据包的大小为 5000 比特$（T=5000 比特T = 5000 \, \text{比特}T=5000比特）。$
- 链路的传输速率为 1 Mbps$$（C=1 Mbps=106 比特/秒C = 1 \, \text{Mbps} = 10^6 \, \text{比特/秒}C=1Mbps=106比特/秒）$$。

那么流量强度 ρ 为：
$$
\rho = \frac{\lambda \times T}{C} = \frac{1000 \, \text{包/秒} \times 5000 \, \text{比特}}{10^6 \, \text{比特/秒}} = 5
$$


在这种情况下，流量强度为 5，表示该链路的负载是其最大容量的 5 倍，可能导致网络拥塞或丢包。

**总结**：

流量强度是衡量网络负载的一个重要参数，它帮助网络管理员了解链路的负载情况，并且通过合理设计流量管理策略（如流量控制、拥塞控制等），保证网络的高效运行。



### 丢包

​	一条链路前的队列只有有限的容量，当到达数据包发现一个满的队列，由于没有空间存储新的数据包，路由器将丢弃该分组。



### traceroute工具

#### **`traceroute` 的工作原理：**

1. **并行发送三次请求：** `traceroute` 会向每个跳跃的路由器发送三个 ICMP 请求包（有时是 UDP 包，取决于 `traceroute` 的实现）。这些请求包是同时发出的，而不是一个接一个的发送。这些包会带有不同的 "TTL"（生存时间，Time To Live）值。
2. **TTL 和路由跳跃：** 每个 ICMP 请求包的 TTL 值从 1 开始，发送到第一个路由器时 TTL 为 1，收到路由器的 ICMP 超时回复（"time exceeded"）后，它会继续发送 TTL 为 2 的请求，直到到达目标主机或者最大跳数为止。
3. **延迟计算：** 对于每个跳跃，`traceroute` 会同时发出三个请求包，通常是通过增加超时机制来记录每个包的往返时间（RTT）。当收到第一个响应包时，记录的是第一个往返的时间，依此类推，直到收集到三个 RTT 值。
4. **为什么是三次？** `traceroute` 发送三次请求的主要目的是为了获得一个平均的延迟值，减少单次测量的偶然性误差。例如，如果某个路由器的响应时间受到某种暂时性因素（如网络拥堵、负载等）的影响，三次测量可以提供一个更准确的代表性延迟。

#### **具体流程：**

- `traceroute` 首先发送三个 ICMP 数据包，TTL=1，发送到第一个路由器（假设第一个路由器响应），记录这三个数据包的 RTT。
- 然后，`traceroute` 发送三个 ICMP 数据包，TTL=2，发送到第二个路由器，记录 RTT。
- 以此类推，直到到达目标或者达到最大跳数。

所以，**每一跳的三个测量值是同时并行发出的，并不是依赖于前一个请求的响应**。当收到响应时，`traceroute` 会记录该响应的 RTT，并在最终输出时显示所有三个测量结果。



### 吞吐量

​	数据包是流量，通信链路是管道。

​	吞吐量取决于数据流过链路的传输速率。



### 分层

**分层的价值**：某层所提供的服务实现易于改变。只要该层对其上面的层提供相同的服务。并且使用来自下面层次的相同服务，当某层的实现变化时，该系统的其余部分保持不变。

> 改变一个服务的实现与改变服务本身是极为不同的！！！



优点：一种结构化方式来讨论系统组件。模块化使更系统组件更为容易。

**缺点**：一层可能会冗余较低层的功能。



#### 协议栈

因特网的协议栈由5个层次组成：物理层、链路层、网络层、运输层、应用层。

##### 应用层

网络应用程序及它们的应用层协议存留的地方。

**HTTP**：提供Web文档的请求和传送。

**SMTP**：提供电子邮件报文的传输。

**FTP**：提供两个端系统之间的文件传送。

**域名转换成IP**：也是借助于特定的应用层协议即域名系统（DNS）完成。



应用层协议分布在多个端系统上，而一个端系统中的应用程序使用协议与另一个端系统中的应用程序交换信息分组。我们把这种位于应用层的信息分组成为**报文**。



##### 运输层

因特网的运输层在应用程序端点之间传送应用层报文。

**TCP**：向应用程序提供**面向连接**的服务。这种服务包括了应用层报文向目的地**确保传输**和**流量控制**。TCP也将长报文划分为短报文，并提供拥塞控制机制，因此当网络拥塞时，源抑制其传输速率。

**UDP**：向应用程序提供无连接服务。这是一种不提供**不必要服务**的服务。没有可靠性、没有流量控制，也没有拥塞控制。

运输层的分组称为**报文段**。



##### 网络层

因特网的网络层负责将称为**数据报**的网络层分组从一台主机移动到另一台主机。

在一台源主机中的因特网运输层协议（TCP或UDP）向网络层递交运输层报文段和目的地址。

**IP协议**：定义了在数据报中的各个字段以及端系统和路由器如何作用于这些字段。

> 网络层包括了网际协议和一些路由选择协议。



##### 链路层

因特网的网络层通过源和目的地之间的一系列**路由器路由**数据报。

为了将分组从一个节点（主机或路由器）移动到路径上的下一个节点，网络层必须依靠该链路层的服务。

链路层分组称为**帧**。

链路层的任务是将帧从一个网络元素移动到邻近的网络元素。



##### 物理层

将帧中的一个个比特从一个节点移动到下一个节点。



#### 封装

在发送主机端，一个应用层报文被传送给运输层。在最简单的情况下，运输层收取到报文并附上附加信息，该首部将被接收端的运输层使用。应用层报文和运输层首部信息一道构成运输层报文段。运输层报文段因此封装了应用层报文。



![](/Users/pengdx/Pengpdx/Notes/Computer-Network-A-Top-Down-Approach/Chapter-1/Image/网络封装.jpg)





















